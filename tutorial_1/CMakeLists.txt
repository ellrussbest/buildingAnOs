cmake_minimum_required(VERSION 3.6.0)

set(ASM nasm)
set(SRC_DIR ${CMAKE_CURRENT_SOURCE_DIR}/src)
set(BUILD_DIR ${CMAKE_CURRENT_BINARY_DIR})

# The add_custom_command command is used to define custom build steps. 
# It specifies the output, dependencies, and commands to execute.
add_custom_command(
    OUTPUT ${BUILD_DIR}/main_floppy.img
    COMMAND cp ${BUILD_DIR}/main.bin ${BUILD_DIR}/main_floppy.img
    COMMAND truncate -s 1440k ${BUILD_DIR}/main_floppy.img
    DEPENDS ${BUILD_DIR}/main.bin
)

add_custom_command(
    OUTPUT ${BUILD_DIR}/main.bin
    COMMAND ${ASM} ${SRC_DIR}/main.asm -f bin -o ${BUILD_DIR}/main.bin
    DEPENDS ${SRC_DIR}/main.asm
)

# The add_custom_target command is used to create a custom target for building main_floppy.img.
add_custom_target(MainFloppy ALL DEPENDS ${BUILD_DIR}/main_floppy.img)

# OUTPUT: This command specifies the output file(s) generated by the custom command. 
# When a target is created in the same directory (CMakeLists.txt file) that specifies 
# any output of the custom command as a source file, 
# it is given a rule to generate the file using the command at build time

# DEPENDS: This command specifies the dependencies of the custom command. 
# If any of the dependencies change, the custom command will be re-run to update the output file(s) as necessary